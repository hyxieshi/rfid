import{u as V,b as D,e as a,f as g,g as M,r as N,h as P,o as c,c as v,d as s,n as k,w as i,i as b,F as C,j as S,k as B,v as y,l as F,m as I,p as R,t as m}from"./index-145879c3.js";const $={class:"body"},A={class:"l"},J={class:"r"},L={style:{display:"flex","justify-content":"center"}},z={class:"select-container"},E=["value"],q=["placeholder"],G=s("tr",null,[s("th",null,"ID"),s("th",null,"名字"),s("th",null,"加入时间"),s("th",null,"查看详情")],-1),H=["onClick"],K={style:{width:"500px",display:"flex","justify-content":"space-around"}},Q={class:"switch"},W=s("span",{class:"slider"},null,-1),X={style:{width:"400px",display:"flex","flex-direction":"column",padding:"0 20px","margin-top":"20px"}},se={__name:"Index",setup(Y){const n=V(),_=D(),h=a(null),r=a(""),u=a(""),x=a([{id:1,name:"ID"},{id:2,name:"姓名"}]);u.value=1;const w=a("");g(u,(l,t)=>{w.value="请输入查询"+x.value.find(e=>e.id==l).name},{deep:!0,immediate:!0});const d=a(1),j=()=>new Promise((l,t)=>{fetch("/api/idList").then(e=>e.json()).then(e=>{h.value=e,l(e)})}),T=l=>{_.push("/details/"+l)};j();let U=M(()=>{if(r.value=="")return h.value;if(u.value==1)return h.value.filter(l=>l.rfid.includes(r.value));if(u.value==2)return h.value.filter(l=>l.name.includes(r.value))});const f=a(!1);f.value=n.userInfo.state;const o=N({pass:"",newpass:""}),O=()=>{o.pass==""||o.newpass==""||fetch("/api/updatePass",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:n.userInfo.user,pass:o.pass,newpass:o.newpass})}).then(l=>l.json()).then(l=>{l?(n.userInfo={},n.ShowTip("密码修改成功，请重新登录").then(t=>{_.push("/")})):n.ShowTip("密码修改失败！请验证旧密码").then(t=>{})})};return P(()=>{}),g(f,(l,t)=>{if(l!=t){const e={user:n.userInfo.user,state:l};console.log(e),fetch("/api/passState",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(p=>p.json()).then(p=>{p&&(n.userInfo.state=p.state,n.ShowTip("密码校验状态已更新").then(Z=>{}))})}}),(l,t)=>(c(),v("div",$,[s("div",A,[s("h2",{onClick:t[0]||(t[0]=e=>d.value=1),class:k({select:d.value==1})}," RFID列表 ",2),s("h2",{onClick:t[1]||(t[1]=e=>d.value=2),class:k({select:d.value==2})}," 设置 ",2)]),s("div",J,[i(s("div",null,[s("div",L,[s("div",z,[i(s("select",{id:"selectOption","onUpdate:modelValue":t[2]||(t[2]=e=>u.value=e),class:"select-dropdown"},[(c(!0),v(C,null,S(x.value,e=>(c(),v("option",{key:e.id,value:e.id,class:"select-option"},m(e.name),9,E))),128))],512),[[B,u.value]])]),i(s("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>r.value=e),class:"filter",placeholder:w.value,style:{"text-align":"left","margin-left":"20px"}},null,8,q),[[y,r.value]])]),s("table",null,[G,(c(!0),v(C,null,S(F(U),e=>(c(),v("tr",{key:e._id},[s("td",null,m(e.rfid),1),s("td",null,m(e.name),1),s("td",null,m(e.createdAtChina),1),s("td",null,[s("button",{onClick:p=>T(e.rfid)},"查看",8,H)])]))),128))])],512),[[b,d.value==1]]),i(s("div",null,[s("div",K,[I(" 是否开始移动端密码校验 "),s("label",Q,[i(s("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>f.value=e)},null,512),[[R,f.value]]),W])]),s("div",X,[I(" 修改登录密码 "),i(s("input",{style:{margin:"10px 0"},type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>o.pass=e),placeholder:"请输入旧密码"},null,512),[[y,o.pass]]),i(s("input",{style:{margin:"10px 0"},type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>o.newpass=e),placeholder:"请输入新密码"},null,512),[[y,o.newpass]]),s("button",{style:{margin:"10px 0"},onClick:O},"确定")])],512),[[b,d.value==2]])])]))}};export{se as default};
